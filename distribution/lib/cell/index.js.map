{"version":3,"sources":["../../../source/lib/cell/index.js"],"names":["_","require","Cell","Row","Column","Style","utils","util","stringSetter","val","logger","ws","wb","chars","chr","match","warn","replace","JSON","stringify","excelRefs","toString","merged","cells","forEach","c","string","getStringIndex","complexStringSetter","numberSetter","undefined","parseFloat","TypeError","format","i","number","booleanSetter","toLowerCase","bool","formulaSetter","formula","dateSetter","thisDate","Date","isNaN","getTime","date","styleSetter","bind","numberFormat","opts","dateFormat","thisStyle","toObject","Object","borderEdges","border","outline","left","firstCol","right","lastCol","top","firstRow","bottom","lastRow","thisCellsBorder","row","col","s","thisCellStyle","createStyle","style","ids","cellXfs","curStyle","styles","newStyleOpts","merge","mergedStyle","hyperlinkSetter","url","displayStr","tooltip","ref","hyperlinkCollection","add","location","display","font","color","underline","mergeCells","cellBlock","Array","length","sort","sortCellRefs","cellRange","rangeCells","okToMerge","mergedCells","cr","curCells","getAllCellsInExcelRange","intersection","arrayIntersectSafe","error","push","matrix","tmpObj","rows","keys","r","a","b","cellAccessor","row1","col1","row2","col2","isMerged","theseCells","lastUsedRow","lastUsedCol","getExcelAlpha","cellRefs","indexOf","prototype","link","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["const _ = require('lodash');\nconst Cell = require('./cell.js');\nconst Row = require('../row/row.js');\nconst Column = require('../column/column.js');\nconst Style = require('../style/style.js');\nconst utils = require('../utils.js');\nconst util = require('util');\n\nfunction stringSetter(val) {\n    let logger = this.ws.wb.logger;\n    let chars, chr;\n    chars = /[\\u0000-\\u0008\\u000B-\\u000C\\u000E-\\u001F\\uD800-\\uDFFF\\uFFFE-\\uFFFF]/;\n    chr = val.match(chars);\n    if (chr) {\n        logger.warn('Invalid Character for XML \"' + chr + '\" in string \"' + val + '\"');\n        val = val.replace(chr, '');\n    }\n\n    if (typeof(val) !== 'string') {\n        logger.warn('Value sent to String function of cells %s was not a string, it has type of %s', \n                    JSON.stringify(this.excelRefs), \n                    typeof(val));\n        val = '';\n    }\n\n    val = val.toString();\n    // Remove Control characters, they aren't understood by xmlbuilder\n    val = val.replace(/[\\u0000-\\u0008\\u000B-\\u000C\\u000E-\\u001F\\uD800-\\uDFFF\\uFFFE-\\uFFFF]/, '');\n\n    if (!this.merged) {\n        this.cells.forEach((c) => {\n            c.string(this.ws.wb.getStringIndex(val));\n        });\n    } else {\n        let c = this.cells[0];\n        c.string(this.ws.wb.getStringIndex(val));\n    }\n    return this;\n}\n\nfunction complexStringSetter(val) {\n    if (!this.merged) {\n        this.cells.forEach((c) => {\n            c.string(this.ws.wb.getStringIndex(val));\n        });\n    } else {\n        let c = this.cells[0];\n        c.string(this.ws.wb.getStringIndex(val));\n    }\n    return this;\n}\n\nfunction numberSetter(val) {\n    if (val === undefined || parseFloat(val) !== val) {\n        throw new TypeError(util.format('Value sent to Number function of cells %s was not a number, it has type of %s and value of %s',\n            JSON.stringify(this.excelRefs),\n            typeof(val),\n            val\n        ));\n    }\n    val = parseFloat(val);\n\n    if (!this.merged) {\n        this.cells.forEach((c, i) => {\n            c.number(val);\n        });\n    } else {\n        var c = this.cells[0];\n        c.number(val);\n    }\n    return this;    \n}\n\nfunction booleanSetter(val) {\n    if (val === undefined || typeof (val.toString().toLowerCase() === 'true' || ((val.toString().toLowerCase() === 'false') ? false : val)) !== 'boolean') {\n        throw new TypeError(util.format('Value sent to Bool function of cells %s was not a bool, it has type of %s and value of %s',\n            JSON.stringify(this.excelRefs),\n            typeof(val),\n            val\n        ));\n    }\n    val = val.toString().toLowerCase() === 'true';\n\n    if (!this.merged) {\n        this.cells.forEach((c, i) => {\n            c.bool(val.toString());\n        });\n    } else {\n        var c = this.cells[0];\n        c.bool(val.toString());\n    }\n    return this;\n}\n\nfunction formulaSetter(val) {\n    if (typeof(val) !== 'string') {\n        throw new TypeError(util.format('Value sent to Formula function of cells %s was not a string, it has type of %s', JSON.stringify(this.excelRefs), typeof(val)));\n    }\n    if (this.merged !== true) {\n        this.cells.forEach((c, i) => {\n            c.formula(val);\n        });\n    } else {\n        var c = this.cells[0];\n        c.formula(val);\n    }\n\n    return this;\n}\n\nfunction dateSetter(val) {\n    let thisDate = new Date(val);\n    if (isNaN(thisDate.getTime())) {\n        throw new TypeError(util.format('Invalid date sent to date function of cells. %s could not be converted to a date.', val));\n    }\n    if (this.merged !== true) {\n        this.cells.forEach((c, i) => {\n            c.date(thisDate);\n        });\n    } else {\n        var c = this.cells[0];\n        c.date(thisDate);\n    }\n    return styleSetter.bind(this)({\n        numberFormat: '[$-409]' + this.ws.wb.opts.dateFormat\n    });\n}\n\nfunction styleSetter(val) {\n    let thisStyle;\n    if (val instanceof Style) {\n        thisStyle = val.toObject();\n    } else if (val instanceof Object) {\n        thisStyle = val;\n    } else {\n        throw new TypeError(util.format('Parameter sent to Style function must be an instance of a Style or a style configuration object'));\n    }\n\n    let borderEdges = {};\n    if (thisStyle.border && thisStyle.border.outline) {\n        borderEdges.left = this.firstCol;\n        borderEdges.right = this.lastCol;\n        borderEdges.top = this.firstRow;\n        borderEdges.bottom = this.lastRow;\n    }\n\n    this.cells.forEach((c) => {\n        if (thisStyle.border && thisStyle.border.outline) {\n            let thisCellsBorder = {};\n            if (c.row === borderEdges.top && thisStyle.border.top) {\n                thisCellsBorder.top = thisStyle.border.top;\n            }\n            if (c.row === borderEdges.bottom && thisStyle.border.bottom) {\n                thisCellsBorder.bottom = thisStyle.border.bottom;\n            }\n            if (c.col === borderEdges.left && thisStyle.border.left) {\n                thisCellsBorder.left = thisStyle.border.left;\n            }\n            if (c.col === borderEdges.right && thisStyle.border.right) {\n                thisCellsBorder.right = thisStyle.border.right;\n            }\n            thisStyle.border = thisCellsBorder;\n        }\n\n        if (c.s === 0) {\n            let thisCellStyle = this.ws.wb.createStyle(thisStyle);\n            c.style(thisCellStyle.ids.cellXfs);\n        } else {\n            let curStyle = this.ws.wb.styles[c.s];\n            let newStyleOpts = _.merge({}, curStyle.toObject(), thisStyle);\n            let mergedStyle = this.ws.wb.createStyle(newStyleOpts);\n            c.style(mergedStyle.ids.cellXfs);\n        }\n    });\n    return this;\n}\n\nfunction hyperlinkSetter(url, displayStr, tooltip) {\n    this.excelRefs.forEach((ref) => {\n        displayStr = typeof displayStr === 'string' ? displayStr : url;\n        this.ws.hyperlinkCollection.add({\n            location: url,\n            display: displayStr,\n            tooltip: tooltip,\n            ref: ref\n        });\n    });\n    stringSetter.bind(this)(displayStr);\n    return styleSetter.bind(this)({\n        font: {\n            color: 'Blue',\n            underline: true\n        }\n    });\n}\n\nfunction mergeCells(cellBlock) {\n    let excelRefs = cellBlock.excelRefs;\n    if (excelRefs instanceof Array && excelRefs.length > 0) {\n        excelRefs.sort(utils.sortCellRefs);\n\n        let cellRange = excelRefs[0] + ':' + excelRefs[excelRefs.length - 1];\n        let rangeCells = excelRefs;\n\n        let okToMerge = true;\n        cellBlock.ws.mergedCells.forEach((cr) => {\n            // Check to see if currently merged cells contain cells in new merge request\n            let curCells = utils.getAllCellsInExcelRange(cr);\n            let intersection = utils.arrayIntersectSafe(rangeCells, curCells);\n            if (intersection.length > 0) {\n                okToMerge = false;\n                cellBlock.ws.wb.logger.error(`Invalid Range for: ${cellRange}. Some cells in this range are already included in another merged cell range: ${cr}.`);\n            }\n        });\n        if (okToMerge) {\n            cellBlock.ws.mergedCells.push(cellRange);\n        }\n    } else {\n        throw new TypeError(util.format('excelRefs variable sent to mergeCells function must be an array with length > 0'));\n    }\n}\n\n/**\n * @class cellBlock\n */\nclass cellBlock {\n\n    constructor() {\n        this.ws;\n        this.cells = [];\n        this.excelRefs = [];\n        this.merged = false;\n    }\n\n    get matrix() {\n        let matrix = [];\n        let tmpObj = {};\n        this.cells.forEach((c) => {\n            if (!tmpObj[c.row]) {\n                tmpObj[c.row] = [];\n            }\n            tmpObj[c.row].push(c);\n        });\n        let rows = Object.keys(tmpObj);\n        rows.forEach((r) => {\n            tmpObj[r].sort((a, b) => {\n                return a.col - b.col;\n            });\n            matrix.push(tmpObj[r]);\n        });\n        return matrix;\n    }\n\n    get firstRow() {\n        let firstRow;\n        this.cells.forEach((c) => {\n            if (c.row < firstRow || firstRow === undefined) {\n                firstRow = c.row;\n            }\n        });\n        return firstRow;\n    }\n\n    get lastRow() {\n        let lastRow;\n        this.cells.forEach((c) => {\n            if (c.row > lastRow || lastRow === undefined) {\n                lastRow = c.row;\n            }\n        });\n        return lastRow;\n    }\n\n    get firstCol() {\n        let firstCol;\n        this.cells.forEach((c) => {\n            if (c.col < firstCol || firstCol === undefined) {\n                firstCol = c.col;\n            }\n        });\n        return firstCol;\n    }\n\n    get lastCol() {\n        let lastCol;\n        this.cells.forEach((c) => {\n            if (c.col > lastCol || lastCol === undefined) {\n                lastCol = c.col;\n            }\n        });\n        return lastCol;\n    }\n}\n\n/**\n * Module repesenting a Cell Accessor\n * @alias Worksheet.cell\n * @namespace\n * @func Worksheet.cell\n * @desc Access a range of cells in order to manipulate values\n * @param {Number} row1 Row of top left cell\n * @param {Number} col1 Column of top left cell\n * @param {Number} row2 Row of bottom right cell (optional)\n * @param {Number} col2 Column of bottom right cell (optional)\n * @param {Boolean} isMerged Merged the cell range into a single cell\n * @returns {cellBlock}\n */\nfunction cellAccessor(row1, col1, row2, col2, isMerged) {\n    let theseCells = new cellBlock();\n    theseCells.ws = this;\n\n    row2 = row2 ? row2 : row1;\n    col2 = col2 ? col2 : col1;\n\n    if (row2 > this.lastUsedRow) {\n        this.lastUsedRow = row2;\n    }\n\n    if (col2 > this.lastUsedCol) {\n        this.lastUsedCol = col2;\n    }\n\n    for (let r = row1; r <= row2; r++) {\n        for (let c = col1; c <= col2; c++) {\n            let ref = `${utils.getExcelAlpha(c)}${r}`;\n            if (!this.cells[ref]) {\n                this.cells[ref] = new Cell(r, c);\n            }\n            if (!this.rows[r]) {\n                this.rows[r] = new Row(r, this);\n            }\n            if (this.rows[r].cellRefs.indexOf(ref) < 0) {\n                this.rows[r].cellRefs.push(ref);\n            }\n\n            theseCells.cells.push(this.cells[ref]);\n            theseCells.excelRefs.push(ref);\n        }\n    }\n    if (isMerged) {\n        theseCells.merged = true;\n        mergeCells(theseCells);\n    }\n\n    return theseCells;\n}\n\n/**\n * @alias cellBlock.string\n * @func cellBlock.string\n * @param {String} val Value of String\n * @returns {cellBlock} Block of cells with attached methods\n */\ncellBlock.prototype.string = function (val) {\n    if (val instanceof Array) {\n        return complexStringSetter.bind(this)(val);\n    } else {\n        return stringSetter.bind(this)(val);\n    }\n};\n\n/**\n * @alias cellBlock.style\n * @func cellBlock.style\n * @param {Object} style One of a Style instance or an object with Style parameters\n * @returns {cellBlock} Block of cells with attached methods\n */\ncellBlock.prototype.style = styleSetter;\n\n/**\n * @alias cellBlock.number\n * @func cellBlock.number\n * @param {Number} val Value of Number\n * @returns {cellBlock} Block of cells with attached methods\n */\ncellBlock.prototype.number = numberSetter;\n\n/**\n * @alias cellBlock.bool\n * @func cellBlock.bool\n * @param {Boolean} val Value of Boolean\n * @returns {cellBlock} Block of cells with attached methods\n */\ncellBlock.prototype.bool = booleanSetter;\n\n/**\n * @alias cellBlock.formula\n * @func cellBlock.formula\n * @param {String} val Excel style formula as string\n * @returns {cellBlock} Block of cells with attached methods\n */\ncellBlock.prototype.formula = formulaSetter;\n\n/**\n * @alias cellBlock.date\n * @func cellBlock.date\n * @param {Date} val Value of Date\n * @returns {cellBlock} Block of cells with attached methods\n */\ncellBlock.prototype.date = dateSetter;\n\n/**\n * @alias cellBlock.link\n * @func cellBlock.link\n * @param {String} url Value of Hyperlink URL\n * @param {String} displayStr Value of String representation of URL\n * @param {String} tooltip Value of text to display as hover\n * @returns {cellBlock} Block of cells with attached methods\n */\ncellBlock.prototype.link = hyperlinkSetter;\n\nmodule.exports = cellAccessor;"]}